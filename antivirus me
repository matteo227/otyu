class DoorSecurity progress = Signal(int):
    threat_found = Signal(str)
    finished = Signal()

    def run(self):
        scanned = 0
        max_files = 3000

        for root, dirs, files in os.walk(os.path.expanduser("~")):
            for file in files:
                scanned += 1
                file_path = os.path.join(root, file)

                for word in SUSPICIOUS_WORDS:
                    if word in file.lower():
                        self.threat_found.emit(file_path)
                        return

                if scanned % 20 == 0:
                    percent = int((scanned / max_files) * 100)
                    self.progress.emit(min(percent, 99))

                if scanned >= max_files:
                    self.progress.emit(100)
                    self.finished.emit()
                    return

                time.sleep(0.005)

        self.progress.emit(100)
        self.finished.emit()


class AntivirusApp(QWidget):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("SecureOS Antivirus")
        self.resize(540, 440)

        layout = QVBoxLayout(self)
        layout.setSpacing(16)

        self.title = QLabel("Protezione del dispositivo")
        self.title.setAlignment(Qt.AlignCenter)
        self.title.setStyleSheet("font-size: 22px; font-weight: 600;")
import tkinter as tk
from tkinter import messagebox
import random
import time

def scan_system():
    scan_button.config(state=tk.DISABLED)
    result_label.config(text="Scansione in corso...")

    root.update()
    time.sleep(2)

    threat_found = random.choice([True, False])

    if threat_found:
        result_label.config(text="Minaccia trovata Risolvi immediatamente.")
    else:
        result_label.config(text="Nessuna minaccia trovata.")

    scan_button.config(state=tk.NORMAL)

root = tk.Tk()
root.title("Scanner di Sicurezza")

scan_button = tk.Button(root, text="Scansiona", command=scan_system)
scan_button.pack(pady=20)

result_label = tk.Label(root, text="")
result_label.pack(pady=20)

root.mainloop()

        self.status = QLabel("Stato: Protetto")
        self.status.setAlignment(Qt.AlignCenter)

        self.progress = QProgressBar()
        self.progress.setValue(0)

        self.scan_button = QPushButton("Avvia scansione completa")
        self.scan_button.setFixedHeight(42)
        self.scan_button.clicked.connect(self.start_scan)

        layout.addWidget(self.title)
        layout.addWidget(self.status)
        layout.addWidget(self.progress)
        layout.addWidget(self.scan_button)

        self.apply_style()

    def apply_style(self):
        self.setStyleSheet("""
        QWidget {
            background-color: #f9f9f9;
            font-family: "Segoe UI";
            font-size: 14px;
        }

        QPushButton {
            background-color: #0078d7;
            color: white;
            border-radius: 8px;
        }

        QPushButton:hover {
            background-color: #005fa3;
        }

        QProgressBar {
            height: 16px;
            border-radius: 8px;
            background: #e0e0e0;
        }

        QProgressBar::chunk {
            background: #0078d7;
            border-radius: 8px;
        }
        """)

    def start_scan(self):
        self.progress.setValue(0)
        self.status.setText("Scansione in corso")
        self.scan_button.setEnabled(False)

        self.thread = ScanThread()
        self.thread.progress.connect(self.progress.setValue)
        self.thread.threat_found.connect(self.handle_threat)
        self.thread.finished.connect(self.scan_finished)
        self.thread.start()

    def handle_threat(self, file_path):
        self.thread.terminate()
        self.status.setText("Minaccia rilevata")

        msg = QMessageBox(self)
        msg.setWindowTitle("Minaccia rilevata")
        msg.setIcon(QMessageBox.Critical)
        msg.setText(f"Malware trovato:\n{file_path}")
        msg.setInformativeText("Scegli un'azione obbligatoria")

        clean_btn = msg.addButton("Pulisci", QMessageBox.AcceptRole)
        remove_btn = msg.addButton("Rimuovi", QMessageBox.DestructiveRole)

        msg.exec()

        if msg.clickedButton() == clean_btn:
            self.status.setText("Minaccia pulita")
        else:
            try:
                os.remove(file_path)
                self.status.setText("File rimosso")
            except:
                self.status.setText("Errore durante la rimozione")

        self.scan_button.setEnabled(True)

    def scan_finished(self):
        self.status.setText("Scansione completata: nessuna minaccia")
        self.scan_button.setEnabled(True)


if __name__ == "__main__":
    app = QApplication(sys.argv)
    app.setStyle("Fusion")
    window = AntivirusApp()
    window.show()
    sys.exit(app.exec())
