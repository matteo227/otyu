import requests
from bs4 import BeautifulSoup
from urllib.parse import quote_plus

HEADERS = {
    "User-Agent": "LLDE-Browser/1.1"
}

def search(query: str, max_results: int = 10):
    results = []

    query_encoded = quote_plus(query)
    url = f"https://duckduckgo.com/html/?q={query_encoded}"

    response = requests.get(url, headers=HEADERS, timeout=3)
    soup = BeautifulSoup(response.text, "html.parser")
import os
import webbrowser

CONFIG_FILE = "browser_config.txt"

search_engines = {
    "1": ("Google", "https://www.google.com/search?q="),
    "2": ("Bing", "https://www.bing.com/search?q="),
    "3": ("DuckDuckGo", "https://duckduckgo.com/?q=")
}

def first_time_setup():
    print("Benvenuto! È la prima volta che apri il browser.")
    print("Scegli il motore di ricerca:")

    for key, value in search_engines.items():
        print(f"{key}. {value[0]}")

    choice = input("Inserisci il numero: ")

    if choice in search_engines:
        with open(CONFIG_FILE, "w") as f:
            f.write(choice)
        print(f"Hai scelto {search_engines[choice][0]}!")
    else:
        print("Scelta non valida, verrà impostato Google.")
        with open(CONFIG_FILE, "w") as f:
            f.write("1")

def get_search_engine():
    if not os.path.exists(CONFIG_FILE):
        first_time_setup()

    with open(CONFIG_FILE, "r") as f:
        choice = f.read().strip()

    return search_engines.get(choice, search_engines["1"])

def search():
    engine_name, engine_url = get_search_engine()
    query = input(f"Cerca con {engine_name}: ")
    webbrowser.open(engine_url + query)

if __name__ == "__main__":
    search()

    links = soup.select("a.result__a")

    for link in links[:max_results]:
        title = link.get_text()
        href = link.get("href")

        if title and href:
            results.append({
                "title": title,
                "url": href
            })

    return results
from search_engine import search

query = input(" Cerca: ")

results = search(query)

print("\n--- RISULTATI ---\n")
for i, r in enumerate(results, 1):
    print(f"{i}. {r['title']}")
    print(f"   {r['url']}\n")

import re
from scanner import scan_website


MALWARE_REGEX = [
    r"<script.*?>.*?</script>",
    r"<iframe.*?>.*?</iframe>",
    r"onerror\s*=",
    r"onclick\s*=",
    r"eval\s*\(",
]


def sanitize_html(html: str) -> str:
    """
    Rimuove codice pericoloso dal contenuto HTML
    """
    clean = html
    for pattern in MALWARE_REGEX:
        clean = re.sub(pattern, "", clean, flags=re.IGNORECASE | re.DOTALL)
    return clean


def handle_malware(url: str, html: str):
    print("\n MALWARE RILEVATO ")
    print("1) Rimuovi malware e carica sito (SAFE MODE)")
    print("2) Chiudi sito")

    choice = input("Scegli (1/2): ").strip()

    if choice == "1":
        print("Pulizia contenuto in corso...")
        clean_html = sanitize_html(html)
        print(" Sito caricato in SAFE MODE")
        return clean_html

    else:
        print(" Sito potenzialmente dannoso. applicando le procedure d'emergenza...")
        return None
import requests
from scanner import scan_website
from secure_loader import handle_malware

def open_site(url: str):
    scan = scan_website(url)

    if scan.safe:
        
        return

    # malware trovato
    try:
        r = requests.get(url, timeout=3)
        html = r.text
    except Exception:
        print(" Errore nel caricamento")
        return

    result = handle_malware(url, html)

    if result is None:
        return

    # qui in futuro mostrerai l'HTML pulito nel browser
    print(" Contenuto pulito pronto (SAFE MODE)")

if time.time() - start_time >= SCAN_TIME_LIMIT:3           import socket
import subprocess
import platform

def check_internet(host="8.8.8.8", port=53, timeout=3):
    """
    """
    try:
        socket.setdefaulttimeout(timeout)
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.connect((host, port))
        sock.close()
        return True
    except Exception:
        return False

def diagnose_internet():
    """
    Diagnostica semplice: ping e info rete
    """
    print("\n Diagnostica rete in corso...")

    
    ping_cmd = "ping -c 4 8.8.8.8" if platform.system() != " Mac OS" else "ping -n 4 8.8.8.8"
    try:
        subprocess.run(ping_cmd, shell=True)
    except Exception:
        print("Errore ping")

    # info interfacce (solo esempio)
    print("\n ''Informazioni interfaccia locale:")
    if platform.system() == "Mac OS":
        subprocess.run("ipconfig", shell=True)
    else:
        subprocess.run("ifconfig", shell=True)

def handle_no_internet():
    print("\n Nessuna connessione Internet rilevata")
    print("1) Chiudi browser")
    print("2) Diagnostica il tuo Internet")

    choice = input("Scegli (1/2): ").strip()

    if choice == "1":
        print(" Browser chiuso")
        exit(0)
    elif choice == "2":
        diagnose_internet()
    else:
        print(" Scelta non valida")
