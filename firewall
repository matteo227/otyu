class: Firewall
import sys
import random
import time

from PySide6.QtWidgets import (
    QApplication, QWidget, QLabel, QPushButton,
    QVBoxLayout, QTableWidget, QTableWidgetItem,
    QProgressBar
)
from PySide6.QtCore import Qt, QThread, Signal


# Regole IMMUTABILI
IMMUTABLE_RULES = {
    "block_trojans": True,
    "block_malware": True,
    "block_suspicious_network": True
}


SIMULATED_THREATS = [
    "Trojan.Generic",
    "Backdoor.Win32",
    "Worm.AutoRun",
    "Spyware.Agent",
    "Ransom.Crypt"
]


class AIScanThread(QThread):
    progress = Signal(int)
    threat = Signal(str, int)
    finished = Signal()

    def run(self):
        for i in range(5):
            time.sleep(1)
            threat_name = random.choice(SIMULATED_THREATS)
            danger = random.randint(30, 100)

            self.progress.emit((i + 1) * 20)

            if danger >= 50:
                self.threat.emit(threat_name, danger)

        self.finished.emit()


class FirewallApp(QWidget):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("SecureOS Firewall")
        self.resize(720, 480)

        layout = QVBoxLayout(self)
        layout.setSpacing(14)

        self.title = QLabel("Firewall e protezione rete")
        self.title.setAlignment(Qt.AlignCenter)
        self.title.setStyleSheet("font-size: 22px; font-weight: 600;")

        self.status = QLabel("Regole attive e immutabili")
        self.status.setAlignment(Qt.AlignCenter)

        self.progress = QProgressBar()
        self.progress.setValue(0)

        self.scan_button = QPushButton("Avvia analisi AI (VirusTotal)")
        self.scan_button.setFixedHeight(40)
        self.scan_button.clicked.connect(self.start_scan)

        self.table = QTableWidget(0, 3)
        self.table.setHorizontalHeaderLabels([
            "Minaccia",
            "Stato",
            "Pericolosità"
        ])
        self.table.horizontalHeader().setStretchLastSection(True)
        self.table.setEditTriggers(QTableWidget.NoEditTriggers)

        layout.addWidget(self.title)
        layout.addWidget(self.status)
        layout.addWidget(self.progress)
        layout.addWidget(self.scan_button)
        layout.addWidget(self.table)

        self.apply_style()

    def apply_style(self):
        self.setStyleSheet("""
        QWidget {
            background-color: #f9f9f9;
            font-family: "Segoe UI";
            font-size: 14px;
        }

        QPushButton {
            background-color: #0078d7;
            color: white;
            border-radius: 8px;
        }

        QPushButton:hover {
            background-color: #005fa3;
        }

        QProgressBar {
            height: 16px;
            border-radius: 8px;
            background: #e0e0e0;
        }

        QProgressBar::chunk {
            background: #0078d7;
            border-radius: 8px;
        }

        QTableWidget {
            background: white;
            border-radius: 8px;
        }
        """)

    def start_scan(self):
        self.progress.setValue(0)
        self.scan_button.setEnabled(False)
        self.table.setRowCount(0)
        self.status.setText("Analisi AI in corso (motore cloud simulato)")

        self.thread = AIScanThread()
        self.thread.progress.connect(self.progress.setValue)
        self.thread.threat.connect(self.add_threat)
        self.thread.finished.connect(self.scan_finished)
        self.thread.start()

    def add_threat(self, name, danger):
        row = self.table.rowCount()
        self.table.insertRow(row)

        self.table.setItem(row, 0, QTableWidgetItem(name))
        self.table.setItem(row, 1, QTableWidgetItem("Bloccata"))
        self.table.setItem(row, 2, QTableWidgetItem(f"{danger}/100"))

    def scan_finished(self):
        self.status.setText("Analisi completata – minacce bloccate")
        self.scan_button.setEnabled(True)


if __name__ == "__main__":
    app = QApplication(sys.argv)
    app.setStyle("Fusion")
    window = FirewallApp()
    window.show()
    sys.exit(app.exec())
